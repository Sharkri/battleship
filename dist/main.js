(()=>{"use strict";class e{constructor(){this.board=[],this.missedShots=[],this.hitShots=[],this.validMoves=[];for(let e=0;e<10;e+=1){const t=[];for(let r=0;r<10;r+=1)this.validMoves.push([e,r]),t.push(null);this.board.push(t)}}at(e,t){return this.board[t][e]}isValidPosition(e,t,r,a=!1){if(a&&this.board.slice(r).length<e)return!1;if(!a&&this.board[r].slice(t).length<e)return!1;const s=this.board[r].slice(t,t+e),o=this.board.slice(r,r+e);return!(!a&&s.some((e=>e))||a&&o.some((e=>e[t])))}isHit(e,t){return this.hitShots.find((r=>JSON.stringify(r)===JSON.stringify([e,t])))}isMiss(e,t){return this.missedShots.find((r=>JSON.stringify(r)===JSON.stringify([e,t])))}placeShip(e,t,r,a=!1){if(!this.isValidPosition(e,t,r,a))return;const s=function(e){let t=0;return{length:e,isSunk:()=>t>=e,hit:()=>{t+=1}}}(e);for(let o=0;o<e;o+=1)a?this.board[r+o][t]=s:this.board[r][t+o]=s}randomizeShips(...e){e.forEach((e=>{const t=[],r=Math.round(Math.random());for(let a=0;a<this.board.length;a+=1)for(let s=0;s<this.board.length;s+=1)this.isValidPosition(e.length,s,a,r)&&t.push([s,a]);const[a,s]=t[Math.floor(Math.random()*t.length)];this.placeShip(e.length,a,s,r)}))}receiveAttack(e,t){this.validMoves=this.validMoves.filter((r=>JSON.stringify(r)!==`[${e},${t}]`));const r=this.at(e,t);return r?(r.hit(),this.hitShots.push([e,t])):this.missedShots.push([e,t]),{square:r}}isGameOver(){for(let e=0;e<10;e+=1)for(let t=0;t<10;t+=1){const r=this.at(t,e);if(r&&!r.isSunk())return!1}return!0}}function t(t,r="player"){let a=new e;const s=()=>a;return"computer"===r?{name:t,getBoard:s,makeRandomMove:function(e){const t=e.getBoard(),{validMoves:r}=t,[a,s]=r[Math.floor(Math.random()*r.length)],{square:o}=t.receiveAttack(a,s);return{square:o,x:a,y:s}}}:{name:t,getBoard:s,createNewBoard:function(){a=new e},attack:function(e,t,r){e.getBoard().receiveAttack(t,r)}}}class r{constructor(e,r){this.playerOne=t(e),this.playerTwo=t(r,"computer"),this.playerTwo.getBoard().randomizeShips({length:5},{length:4},{length:3},{length:3},{length:2})}}const a=function(){const e=document.querySelector(".modal"),t=document.querySelector(".game-ended-text"),r=document.querySelector(".place-ship-modal"),a=document.getElementsByClassName("ship-container");function s(e,t){const r=document.querySelector(`.${t}`);r.textContent="";for(let a=0;a<10;a+=1)for(let s=0;s<10;s+=1){const o=document.createElement("button");o.classList.add("square"),o.setAttribute("data-coord-x",s),o.setAttribute("data-coord-y",a),e.isHit(s,a)&&o.classList.add("hit"),e.isMiss(s,a)&&o.classList.add("missed");const i=e.at(s,a);i&&"enemy-board"!==t&&o.classList.add("ship"),i?.isSunk()&&o.classList.add("sunk"),r.appendChild(o)}}function o(...e){e.forEach((e=>s(e.board,e.className)))}function i(e){[...a].forEach((t=>{t.firstElementChild.setAttribute("data-vertical","false"),e?t.classList.remove("hidden"):t.classList.add("hidden")}))}return{render:o,renderBoard:s,restart:function(...t){o(...t),i(!0),e.classList.remove("open"),r.classList.add("open")},endGame:function(r){e.classList.add("open"),t.textContent=r},startGame:function(...e){o(...e),r.classList.remove("open")},toggleShips:i}}(),s=document.querySelectorAll(".ship"),o=document.querySelector("#start-game"),i=document.querySelector(".enemy-board"),d=document.querySelector(".preview-board"),n=document.querySelector(".play-again"),l=document.querySelector("#randomize-board"),c=document.querySelector("#reset-board");let h,u=new r;a.render({board:u.playerOne.getBoard(),className:"preview-board"}),o.addEventListener("click",(()=>a.startGame({board:u.playerOne.getBoard(),className:"player-board"},{board:u.playerTwo.getBoard(),className:"enemy-board"}))),i.addEventListener("click",(e=>{const{playerOne:t,playerTwo:r}=u,s=t.getBoard(),o=r.getBoard();if(e.target.classList.length>1)return;const i=+e.target.getAttribute("data-coord-x"),d=+e.target.getAttribute("data-coord-y");t.attack(r,i,d),a.renderBoard(o,"enemy-board"),o.isGameOver()?a.endGame("You won"):(r.makeRandomMove(t),a.renderBoard(s,"player-board"),s.isGameOver()&&a.endGame("You lost"))})),d.addEventListener("drop",(e=>{e.preventDefault();const t=u.playerOne.getBoard();e.target.classList.remove("drag-over"),e.target.classList.remove("invalid");const r=+e.target.getAttribute("data-coord-x"),s=+e.target.getAttribute("data-coord-y"),i="true"===h.dataset.vertical,{length:d}=h.children;t.isValidPosition(d,r,s,i)&&(t.placeShip(d,r,s,i),a.renderBoard(t,"preview-board"),h.parentNode.classList.add("hidden"),document.querySelector(".ship-container:not(.hidden)")||(o.disabled=!1))})),d.addEventListener("dragover",(e=>{e.preventDefault();const t=+e.target.getAttribute("data-coord-x"),r=+e.target.getAttribute("data-coord-y"),{length:a}=h.children,s="true"===h.dataset.vertical;if(u.playerOne.getBoard().isValidPosition(a,t,r,s))for(let e=0;e<a;e+=1)s?document.querySelector(`[data-coord-y="${[r+e]}"][data-coord-x="${[t]}"]`).classList.add("preview-ship"):document.querySelector(`[data-coord-y="${[r]}"][data-coord-x="${[t+e]}"]`).classList.add("preview-ship");else e.target.classList.add("invalid")})),d.addEventListener("dragleave",(e=>{e.preventDefault(),e.target.classList.remove("invalid"),[...document.getElementsByClassName("preview-ship")].forEach((e=>e.classList.remove("preview-ship")))})),s.forEach((e=>e.addEventListener("dragstart",(e=>{h=e.target})))),document.querySelectorAll(".rotate").forEach((e=>e.addEventListener("click",(e=>{const t=e.target.closest("svg").previousElementSibling,r="true"===t.getAttribute("data-vertical");t.setAttribute("data-vertical",!r)})))),n.addEventListener("click",(()=>{u=new r,o.disabled=!0,a.restart({board:u.playerOne.getBoard(),className:"preview-board"},{board:u.playerOne.getBoard(),className:"player-board"},{board:u.playerTwo.getBoard(),className:"enemy-board"})})),l.addEventListener("click",(()=>{a.toggleShips(!1),u.playerOne.createNewBoard();const e=u.playerOne.getBoard();e.randomizeShips({length:5},{length:4},{length:3},{length:3},{length:2}),a.renderBoard(e,"preview-board"),o.disabled=!1})),c.addEventListener("click",(()=>{a.toggleShips(!0),u.playerOne.createNewBoard(),a.renderBoard(u.playerOne.getBoard(),"preview-board"),o.disabled=!0}))})();